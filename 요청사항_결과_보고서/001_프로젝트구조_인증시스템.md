# [001] Phase 1.1 & 1.2 프로젝트 구조 및 인증 시스템

## 요청 정보

- **날짜:** 2026-01-29
- **요청 내용:** 개발 순서 Phase 1.1과 1.2 진행
  - 1.1 프로젝트 구조 정리
  - 1.2 인증 시스템

---

## 진행 내용

### 1.1 프로젝트 구조 정리

#### 1) 패키지 추가 (pubspec.yaml)
- `provider: ^6.1.2` – 상태관리
- `go_router: ^14.6.2` – 라우팅

#### 2) 폴더 구조 생성

```
lib/
├── core/
│   ├── constants/
│   │   └── app_colors.dart      # 색상 팔레트
│   └── theme/
│       └── app_theme.dart       # 라이트/다크 테마
├── models/                      # 데이터 모델 (추후 사용)
├── providers/
│   └── auth_provider.dart       # 인증 상태관리
├── router/
│   └── app_router.dart          # go_router 설정
├── screens/
│   ├── auth/
│   │   └── login_screen.dart    # 로그인 화면
│   ├── home/
│   │   └── home_screen.dart     # 홈 (하단 탭 4개)
│   └── splash/
│       └── splash_screen.dart   # 스플래시
├── services/
│   └── auth_service.dart        # 인증 서비스
├── widgets/                     # 재사용 위젯 (추후 사용)
├── firebase_options.dart
└── main.dart                    # 앱 진입점
```

#### 3) 테마/색상 시스템 구축

**app_colors.dart:**
- Paper (배경): `#FAF7F0`
- Ink (텍스트): `#0F172A`
- Gold (강조): `#B08D57`
- Muted Gray (비활성): `#94A3B8`
- Border (구분선): `#E5E7EB`
- 다크모드 색상 포함

**app_theme.dart:**
- 라이트 테마
- 다크 테마
- AppBar, BottomNavigationBar, Button 스타일 통일

#### 4) 라우팅 설정 (go_router)

- `/` – SplashScreen (로딩)
- `/login` – LoginScreen
- `/home` – HomeScreen
- 인증 상태에 따른 자동 리다이렉트

---

### 1.2 인증 시스템

#### 1) AuthService 분리

- Google 로그인 로직 분리
- 로그아웃 처리
- Firebase Auth와 Google Sign-In 연동

#### 2) AuthProvider 생성 (상태관리)

- `AuthStatus` 열거형: initial, authenticated, unauthenticated
- `isLoading`, `errorMessage` 상태 관리
- `authStateChanges` 스트림 구독 → 자동 로그인

#### 3) 화면 구현

**SplashScreen:**
- 앱 시작 시 로딩 화면
- 인증 상태 확인 후 자동 분기

**LoginScreen:**
- Google 로그인 버튼
- 에러 메시지 표시
- 로딩 상태 표시

**HomeScreen:**
- 하단 탭 4개 (친구 / 채팅 / 모아보기 / 설정)
- 채팅 탭이 기본 선택
- 설정 탭에서 프로필 표시 및 로그아웃

#### 4) 자동 로그인 플로우

```
앱 시작
    ↓
SplashScreen (로딩)
    ↓
Firebase authStateChanges 확인
    ↓
┌─ 로그인 됨 → HomeScreen
└─ 로그아웃 됨 → LoginScreen
```

---

## 결과

| 항목 | 상태 |
|------|------|
| 폴더 구조 설계 | ✅ 완료 |
| 상태관리 (Provider) | ✅ 완료 |
| 라우팅 (go_router) | ✅ 완료 |
| Firebase 연동 | ✅ 완료 |
| Google 로그인 | ✅ 완료 |
| 로그아웃 처리 | ✅ 완료 |
| 자동 로그인 | ✅ 완료 |

---

## 변경된 파일

### 신규 생성
- `lib/core/constants/app_colors.dart`
- `lib/core/theme/app_theme.dart`
- `lib/providers/auth_provider.dart`
- `lib/router/app_router.dart`
- `lib/screens/auth/login_screen.dart`
- `lib/screens/home/home_screen.dart`
- `lib/screens/splash/splash_screen.dart`
- `lib/services/auth_service.dart`

### 수정
- `pubspec.yaml` – provider, go_router 추가
- `lib/main.dart` – 리팩토링 (Provider, go_router 적용)

### 문서 업데이트
- `잉크_앱프로젝트_정보/개발_순서.md` – Phase 1.1, 1.2 체크 완료

---

## 관련 커밋

- **커밋 해시:** `d886322`
- **커밋 메시지:** Phase 1.1 & 1.2 완료: 프로젝트 구조 및 인증 시스템

---

## 테스트 방법

```bash
cd /Users/ojaebaek/ink/ink_talk
flutter run
```

1. 앱 시작 → 스플래시 화면
2. 로그인 안 됨 → 로그인 화면
3. Google 로그인 → 홈 화면
4. 앱 재시작 → 자동 로그인 (홈 화면 바로 진입)
5. 설정 → 로그아웃 → 로그인 화면

---

## 기술 선택 이유

| 기술 | 선택 이유 |
|------|-----------|
| **Provider** | Flutter 공식 권장, 간단하고 러닝커브 낮음, 작은~중간 규모 앱에 적합 |
| **go_router** | 선언적 라우팅, 인증 기반 리다이렉트 간편, 딥링크 지원, refreshListenable로 상태 연동 용이 |
| **Firebase Auth** | Google 로그인 간편 연동, 다양한 소셜 로그인 확장 가능 |

---

## 개발 중 발생한 오류 및 대처

### 오류 1: Firebase 패키지 버전 충돌

**증상:**
```
Because firebase_auth >=5.3.4 <5.6.2 requires firebase_core_platform_interface ^5.3.1...
firebase_core ^4.4.0 is incompatible with firebase_auth ^5.5.1
```

**원인:**
- `firebase_core: ^4.4.0`과 `firebase_auth: ^5.5.1` 버전 간 의존성 충돌

**해결:**
```yaml
# 변경 전
firebase_auth: ^5.5.1

# 변경 후
firebase_auth: ^6.1.4
```
- firebase_auth를 최신 버전(^6.1.4)으로 업그레이드하여 해결

---

### 오류 2: Unused Import 경고

**증상:**
```
warning • Unused import: 'package:flutter/material.dart' • lib/router/app_router.dart
warning • Unused import: 'package:provider/provider.dart' • lib/router/app_router.dart
```

**원인:**
- app_router.dart에서 사용하지 않는 import 문 존재

**해결:**
```dart
// 변경 전
import 'package:flutter/material.dart';
import 'package:go_router/go_router.dart';
import 'package:provider/provider.dart';

// 변경 후
import 'package:go_router/go_router.dart';
```
- 사용하지 않는 import 제거

---

## 알려진 제한사항 / TODO

- [ ] Apple 로그인 미구현 (iOS App Store 배포 시 필수)
- [ ] 이메일/비밀번호 로그인 미구현
- [ ] 에러 핸들링 고도화 필요 (네트워크 에러, 서버 에러 구분)
- [ ] 네트워크 상태 체크 미구현
- [ ] 로그인 화면 로고 이미지 적용 필요

---

## 참고 문서

- `잉크_앱프로젝트_정보/INK_최종_기능_명세서_v1.0.md`
- `잉크_앱프로젝트_정보/INK_디자인_명세서_v1.0.md`
- `잉크_앱프로젝트_정보/기본_디자인_색정보.md`
- `잉크_앱프로젝트_정보/개발_순서.md`

---

## 다음 단계

| Phase | 내용 |
|-------|------|
| **1.3** | Firestore 컬렉션 설계 (users, friends, rooms, strokes, messages, tags) |
| **2.1** | 반응형 레이아웃 기반 (폰/패드/PC 감지) |
| **2.2** | 하단 탭 네비게이션 완성 |
