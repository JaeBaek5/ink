# [012] Phase 12 공유/내보내기

## 요청 정보

- **날짜:** 2026-01-29
- **요청 내용:** 개발 순서 Phase 12 (공유/내보내기) 진행
  - 12.1 링크 공유
  - 12.2 내보내기
  - 12.3 방장 설정

---

## 진행 내용

### 12.1 링크 공유

| 기능 | 구현 |
|------|------|
| 링크 생성 | `createShareLink()` |
| 공유 | `share_plus` 패키지 |
| 링크 형식 | `https://ink.app/room/{roomId}?ref={userId}` |

```dart
final link = await exportService.createShareLink(
  roomId: widget.room.id,
  userId: authProvider.user?.uid ?? '',
);
await exportService.shareLink(link, message: '...');
```

---

### 12.2 내보내기

| 포맷 | 구현 |
|------|------|
| PNG | `exportToPng()` |
| JPG | `exportToJpg()` |
| PDF | `exportToPdf()` (pdf 패키지) |

#### 내보내기 다이얼로그
- 포맷 선택 (ChoiceChip)
- 워터마크 옵션 (CheckboxListTile)
- 내보내기 버튼

```dart
void _showExportDialog() {
  // 포맷 선택: PNG, JPG, PDF
  // 워터마크: "사용자명 · INK"
}
```

---

### 12.3 방장 설정

| 설정 | 상태 |
|------|------|
| 내보내기 허용/차단 | TODO: 모델 확장 필요 |
| 워터마크 강제 | TODO |
| 로그 공개/비공개 | TODO |

---

## 결과

| 항목 | 상태 |
|------|------|
| ExportService | ✅ 완료 |
| 링크 생성 | ✅ 완료 |
| 링크 공유 | ✅ 완료 |
| 내보내기 다이얼로그 | ✅ 완료 |
| PNG 내보내기 | ✅ 완료 |
| JPG 내보내기 | ✅ 완료 |
| PDF 내보내기 | ✅ 완료 |
| 워터마크 옵션 | ✅ 완료 |

---

## 변경된 파일

### 신규 생성

- `lib/services/export_service.dart` – 내보내기 서비스

### 수정

- `lib/screens/canvas/canvas_screen.dart`
  - `_shareLink()` 메서드 추가
  - `_showExportDialog()` 메서드 추가
  - `_exportCanvas()` 메서드 추가
- `pubspec.yaml`
  - `share_plus: ^10.1.4`
  - `pdf: ^3.11.2`
  - `path_provider: ^2.1.5`

### 문서 업데이트

- `잉크_앱프로젝트_정보/개발_순서.md` – Phase 12 체크 완료

---

## 관련 커밋

- **커밋 해시:** `8a0afae`
- **커밋 메시지:** Phase 12 완료: 공유/내보내기

---

## 추가된 패키지

| 패키지 | 용도 |
|--------|------|
| `share_plus` | 링크/파일 공유 |
| `pdf` | PDF 생성 |
| `path_provider` | 임시 파일 경로 |

---

## 테스트 방법

```bash
cd /Users/ojaebaek/ink/ink_talk
flutter run
```

### 링크 공유
1. 캔버스 화면에서 **더보기 (⋯)** 버튼 클릭
2. **링크 공유** 선택
3. 공유 시트에서 앱 선택

### 내보내기
1. 캔버스 화면에서 **더보기 (⋯)** 버튼 클릭
2. **내보내기** 선택
3. 포맷 선택 (PNG/JPG/PDF)
4. 워터마크 옵션 설정
5. **내보내기** 버튼 클릭

---

## 기술 선택 이유

| 기술 | 선택 이유 |
|------|-----------|
| **share_plus** | 크로스 플랫폼 공유 |
| **pdf 패키지** | 순수 Dart PDF 생성 |
| **path_provider** | 임시 파일 저장 경로 |

---

## 알려진 제한사항 / TODO

- [ ] 실제 캔버스 캡처 구현 (RenderRepaintBoundary)
- [ ] 웹뷰 읽기 전용 모드 (앱 미설치 사용자)
- [ ] 방장 내보내기 허용/차단 설정
- [ ] 내보내기 로그 기록
- [ ] 부분 영역 내보내기

---

## 참고 문서

- `잉크_앱프로젝트_정보/INK_최종_기능_명세서_v1.0.md` (10장 공유, 12장 내보내기)
- `잉크_앱프로젝트_정보/INK_디자인_명세서_v1.0.md` (13장 공유/내보내기)
- `잉크_앱프로젝트_정보/개발_순서.md`

---

## 다음 단계

| Phase | 내용 |
|-------|------|
| **13** | 멀티 윈도우 |
| **14** | 실시간 성능 최적화 |
| **15** | 테스트 및 QA |
