# [011] Phase 11 모아보기 (태그함)

## 요청 정보

- **날짜:** 2026-01-29
- **요청 내용:** 개발 순서 Phase 11 (모아보기/태그함) 진행
  - 11.1 태그 생성
  - 11.2 모아보기 화면
  - 11.3 원본 점프

---

## 진행 내용

### 11.1 태그 생성

| 구성 요소 | 설명 |
|-----------|------|
| `TagModel` | 태그 데이터 모델 (기존) |
| `TagService` | Firestore CRUD + 스트림 |
| `TagProvider` | 상태 관리 + 필터 |

#### TagModel 필드
```dart
- id, roomId
- taggerId (태그한 사람)
- taggedUserId (태그된 사람)
- targetType (stroke/image/video/text)
- targetId
- areaX, areaY, areaWidth, areaHeight (손글씨 영역)
- createdAt, isRead
```

---

### 11.2 모아보기 화면

| 기능 | 구현 |
|------|------|
| 검색 | AlertDialog + TextField |
| 필터 (유형) | BottomSheet + FilterChip |
| 정렬 | 최신순 (기본) |
| 카드 리스트 | ListView + 태그 카드 |
| 읽음 표시 | 미읽음 = 골드 테두리 |
| 새로고침 | RefreshIndicator |

#### 태그 카드 UI
- 아이콘 (타입별 색상)
- 타입명
- 채팅방 ID
- 시간 (상대 시간)
- 화살표 (점프)

---

### 11.3 원본 점프

| 동작 | 구현 |
|------|------|
| 카드 탭 | `_jumpToOriginal()` |
| 읽음 처리 | `tagProvider.markAsRead()` |
| 채팅방 이동 | `Navigator.push(CanvasScreen)` |
| 위치 점프 | `jumpToPosition` 파라미터 |

```dart
CanvasScreen(
  room: room,
  jumpToPosition: Offset(tag.areaX!, tag.areaY!),
)
```

---

## 결과

| 항목 | 상태 |
|------|------|
| TagService | ✅ 완료 |
| TagProvider | ✅ 완료 |
| 모아보기 화면 | ✅ 완료 |
| 검색 | ✅ 완료 |
| 필터 (유형) | ✅ 완료 |
| 카드 리스트 | ✅ 완료 |
| 원본 점프 | ✅ 완료 |
| 읽음 처리 | ✅ 완료 |

---

## 변경된 파일

### 신규 생성

- `lib/services/tag_service.dart` – 태그 서비스
- `lib/providers/tag_provider.dart` – 태그 Provider

### 수정

- `lib/main.dart`
  - `TagProvider` 등록
- `lib/screens/home/tabs/tags_tab.dart`
  - 전체 재작성 (검색, 필터, 카드, 점프)
- `lib/screens/canvas/canvas_screen.dart`
  - `jumpToPosition` 파라미터 추가

### 문서 업데이트

- `잉크_앱프로젝트_정보/개발_순서.md` – Phase 11 체크 완료

---

## 관련 커밋

- **커밋 해시:** `c60d263`
- **커밋 메시지:** Phase 11 완료: 모아보기 (태그함)

---

## Firestore 데이터 구조

### tags 컬렉션 (전역)
```
tags/{tagId}
{
  "roomId": "...",
  "taggerId": "...",
  "taggedUserId": "...",
  "targetType": "stroke",
  "targetId": "...",
  "areaX": 100.0,
  "areaY": 200.0,
  "areaWidth": 50.0,
  "areaHeight": 30.0,
  "createdAt": Timestamp,
  "isRead": false
}
```

---

## 테스트 방법

```bash
cd /Users/ojaebaek/ink/ink_talk
flutter run
```

### 모아보기 탭
1. 하단 탭에서 **모아보기** 선택
2. 태그된 항목 카드 확인
3. **검색** 버튼으로 검색
4. **필터** 버튼으로 유형 필터
5. 카드 **탭** → 원본 점프

---

## 기술 선택 이유

| 기술 | 선택 이유 |
|------|-----------|
| **전역 tags 컬렉션** | 여러 방의 태그를 한 번에 조회 |
| **클라이언트 필터** | 복합 인덱스 없이 유연한 필터링 |
| **jumpToPosition** | 원본 위치로 직접 점프 |

---

## 알려진 제한사항 / TODO

- [ ] 태그 생성 UI (영역 선택 → @친구 선택)
- [ ] 태그 영역 하이라이트
- [ ] 방 필터
- [ ] 기간 필터 UI
- [ ] 그리드 뷰 옵션

---

## 참고 문서

- `잉크_앱프로젝트_정보/INK_최종_기능_명세서_v1.0.md` (13장 모아보기)
- `잉크_앱프로젝트_정보/INK_디자인_명세서_v1.0.md` (12장 모아보기)
- `잉크_앱프로젝트_정보/개발_순서.md`

---

## 다음 단계

| Phase | 내용 |
|-------|------|
| **12** | 내보내기 (Export) |
| **13** | 공유/링크 |
| **14** | 멀티 윈도우 |
