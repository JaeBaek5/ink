# [007] Phase 7 텍스트 입력

## 요청 정보

- **날짜:** 2026-01-29
- **요청 내용:** 개발 순서 Phase 7 (텍스트 입력) 진행
  - 7.1 위치 지정형 (정밀 배치)
  - 7.2 빠른 텍스트 (연속 작성)

---

## 진행 내용

### 7.1 위치 지정형 텍스트 (정밀 배치)

#### 동작 흐름
```
툴바 [T] 버튼 클릭 → 텍스트 모드 → 캔버스 탭 → 입력 다이얼로그 → 추가 버튼 → 해당 위치에 텍스트 배치
```

#### 구현
- **InputMode.text**: 텍스트 입력 모드
- **_onTapUp()**: 텍스트 모드일 때 다이얼로그 표시
- **_showTextInputDialog()**: 텍스트 입력 다이얼로그

---

### 7.2 빠른 텍스트 (연속 작성)

#### 동작 흐름
```
툴바 [T+] 버튼 클릭 → 빠른 텍스트 모드 → 하단 입력창 표시 → 입력 후 전송 → 마지막 위치 아래에 자동 배치 → 연속 입력 가능
```

#### 구현
- **InputMode.quickText**: 빠른 텍스트 모드
- **_buildQuickTextInput()**: 하단 입력 UI
- **addQuickText()**: 마지막 위치 기준 자동 배치

---

## 결과

| 항목 | 상태 |
|------|------|
| 위치 지정형 텍스트 | ✅ 완료 |
| 텍스트 입력 다이얼로그 | ✅ 완료 |
| 빠른 텍스트 모드 | ✅ 완료 |
| 하단 입력 UI | ✅ 완료 |
| 자동 배치 | ✅ 완료 |
| Firestore 저장 | ✅ 완료 |
| 실시간 동기화 | ✅ 완료 |

---

## 변경된 파일

### 신규 생성

- `lib/services/text_service.dart` – 텍스트 Firestore 서비스

### 수정

- `lib/screens/canvas/canvas_controller.dart`
  - `InputMode` enum 추가
  - 텍스트 관련 변수/메서드 추가
  - 텍스트 스트림 구독
- `lib/widgets/canvas/drawing_canvas.dart`
  - 텍스트 렌더링 (`_buildTextWidget`)
  - 텍스트 입력 다이얼로그 (`_showTextInputDialog`)
  - 텍스트 옵션 메뉴 (`_showTextOptions`)
- `lib/widgets/canvas/pen_toolbar.dart`
  - 텍스트 버튼 추가 (`_buildTextButtons`)
- `lib/screens/canvas/canvas_screen.dart`
  - 빠른 텍스트 입력 UI (`_buildQuickTextInput`)

### 문서 업데이트

- `잉크_앱프로젝트_정보/개발_순서.md` – Phase 7 체크 완료

---

## 관련 커밋

- **커밋 해시:** `19835fc`
- **커밋 메시지:** Phase 7 완료: 텍스트 입력

---

## Firestore 데이터 구조

### texts 컬렉션
```
rooms/{roomId}/texts/{textId}
{
  "roomId": "...",
  "senderId": "...",
  "type": "text",
  "content": "텍스트 내용",
  "positionX": 100.0,
  "positionY": 200.0,
  "createdAt": Timestamp,
  "isDeleted": false
}
```

---

## 테스트 방법

```bash
cd /Users/ojaebaek/ink/ink_talk
flutter run
```

### 위치 지정형 텍스트
1. 툴바에서 **[T]** 버튼 클릭 (골드색으로 활성화)
2. 캔버스 원하는 위치 **탭**
3. 입력 다이얼로그에서 텍스트 입력
4. **추가** 버튼 클릭
5. 해당 위치에 텍스트 표시

### 빠른 텍스트
1. 툴바에서 **[T+]** 버튼 클릭
2. 하단 입력창 표시
3. 텍스트 입력 후 **전송** (또는 Enter)
4. 자동 위치에 텍스트 표시
5. 연속 입력 가능
6. **X** 버튼으로 종료

### 텍스트 삭제
1. 텍스트 **롱프레스**
2. 옵션 메뉴에서 **삭제** 선택

---

## 기술 선택 이유

| 기술 | 선택 이유 |
|------|-----------|
| **MessageModel 재활용** | 기존 모델에 positionX/Y 이미 정의됨 |
| **별도 texts 컬렉션** | 스트로크와 분리하여 관리 용이 |
| **Stack 위젯** | 캔버스 위에 텍스트 오버레이 |

---

## 알려진 제한사항 / TODO

- [ ] 텍스트 이동 (드래그)
- [ ] 텍스트 수정
- [ ] 폰트 크기/색상 선택
- [ ] 텍스트 스타일 (굵기, 기울임)

---

## 참고 문서

- `잉크_앱프로젝트_정보/INK_최종_기능_명세서_v1.0.md` (5.6 텍스트 입력)
- `잉크_앱프로젝트_정보/INK_디자인_명세서_v1.0.md` (8. 스마트폰 텍스트 입력)
- `잉크_앱프로젝트_정보/개발_순서.md`

---

## 다음 단계

| Phase | 내용 |
|-------|------|
| **8** | 도형/선 + 편집 시스템 |
| **9** | 업로드/첨부 (사진/영상/PDF) |
| **10** | 내보내기 (Export) |
